# 远程桌面状态监控服务

这是一个用于监控Windows远程桌面连接状态的Web服务。当有外部用户通过远程桌面连接到这台电脑时，您可以通过Web界面查看连接状态和IP地址信息。

## 功能特性

- 🔍 **实时检测**: 自动检测远程桌面连接状态
- 🌐 **连接监控**: 显示当前远程桌面连接的IP地址信息
- 🌐 **Web界面**: 美观的Web界面显示当前状态
- 🔄 **自动刷新**: 每10秒自动更新状态
- 📱 **响应式设计**: 支持手机和电脑访问

## 安装和运行

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 运行服务

```bash
python main.py
```

### 3. 访问服务

打开浏览器访问: http://localhost:51472

## API接口

- `GET /` - 主页面
- `GET /api/status` - 获取当前状态
- `GET /api/users` - 获取远程桌面连接用户
- `GET /api/force_check` - 强制检查状态

## 检测原理

服务使用基于网络连接的检测方法，确保准确性：

1. **端口连接检测**: 使用 `netstat -an` 检查端口43389的ESTABLISHED连接
2. **进程信息获取**: 使用 `netstat -ano` 获取连接对应的进程ID和名称
3. **IP地址解析**: 提取远程连接的IP地址信息
4. **连接状态验证**: 验证连接状态为 `ESTABLISHED` 的RDP连接
5. **外部连接检测**: 只检测来自外部IP的远程桌面连接
6. **状态确认机制**: 状态变化时进行二次确认，避免误判

## 使用场景

- **办公室共享电脑**: 监控是否有外部用户通过远程桌面使用电脑
- **服务器监控**: 查看是否有外部用户远程连接到服务器
- **家庭电脑**: 了解是否有外部用户远程使用电脑
- **安全监控**: 检测外部远程桌面连接状态和来源IP地址
- **工作状态通知**: 让其他人知道有外部用户正在远程使用电脑
- **网络监控**: 监控RDP端口43389的外部连接状态

## 注意事项

- 需要管理员权限才能访问某些系统信息
- 服务默认运行在51472端口
- 支持局域网内其他设备访问
- 建议在防火墙中开放相应端口
- 如果状态显示不准确，可以使用"强制检查"按钮
- 服务会自动进行状态确认，避免误判
- 只能检测到连接的IP地址，无法获取具体用户名
- 不检测当前用户，只检测来自外部IP的远程连接

## 自定义配置

您可以通过修改 `main.py` 中的以下参数来自定义服务：

- 端口号: 修改 `app.run(port=51472)`
- 检查间隔: 修改 `time.sleep(10)` 中的数值
